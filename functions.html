<html><head>
  <meta charset="utf-8">
  <meta name="description" content="Introduction to JavaScript functional programming.">
  <meta name="author" content="Elucian Moise">
  <meta name="keywords" content="javascript, js, programming, tutorial">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Website title -->
  <title>JS Functions</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <!-- Icon -->
  <link rel="icon" type="image/png"  href="../images/favicon.ico">
  <!-- Prism Highlighter -->
  <link rel="stylesheet" href="../prism.css">
  <script src="../prism.js"></script>
  <!-- custom css -->
  <link rel="stylesheet" href="../sage.css">
  </head>
<body>

<div class="container">

<!-- header -->
<div class="row">
    <div class="col">
        <a href="https://sagecode.net"><img src="../images/sage-logo.svg" alt="Sage-Code Laboratory" height="80"/></a>
    </div>
    <div class="col bottom-right">
        <a href="index.html#js-bookmark">index</a>&lt;--
    </div>
</div>


<hr>

<h2>JavaScript Functions</h2>

<div class="alert alert-secondary shadow-sm">You may be familiar with function formulas from mathematics: y = f(x). In programming a function is a named block of code designed to perform a particular task. Functions usually have one or more parameters and should <em>return</em> a result.
</div>

<div align="center">
  <img src="img/function.jpg" alt="function" srcset="img/function.svg" width="580" class="img-fluid protect rounded shadow border" >
  <p>Function Principle</p>
</div>

<h4>Bookmarks:</h4>

<ul>
<li><a href="#declaration">Function Declaration</a></li>
<li><a href="#invocation">Function Invocation</a></li>
<li><a href="#parameters">Function Parameters</a></li>
<li><a href="#result">Function Results</a></li>
<li><a href="#output">Output Parameters</a></li>
<li><a href="#expression">Expression Functions</a></li>
<li><a href="#arrow">Arrow Functions</a></li>
<li><a href="#execution">Function Execution</a></li>
<li><a href="#promises">Promise Objects</a></li>
<li><a href="#asynch">Asynchronous Functions</a></li>
</ul>

<h2><a id="declaration">Function Declaration</h2>

<p>We declare functions in JavaScript using keyword: "function". Usually a function has a name but there are cases when function do not have a name.This is called "anonymous" function. After function name we must specify a list of parameters.This list is enclosed in round paranthesis and parameter names are separated by comma.After the parameter list we open the function block using squigly brackets {...}.
</p>

<h4>Example:</h4>
<p>Next we define a function and an expression that call the function . A return statement execute first expression before returning the result to the function call. The second expression is used in assignment statement. It is also the function call.On last statement we verify value of x using console message.</p>

<pre><code class="language-javascript line-numbers">/* define a function */
function myFunction(p1, p2) {
   return p1 * p2; //multiplication
}
/* call a function */
let x = myFunction(5, 5);
console.log(x); // 25</code></pre>


<h2><a id="invocation"/>Function Invocation</h2>
<p>The JavaScript function can be call using operator: () after function name. Enclosed in these parenthesis you can use literals, variables or expressions, or not. Remember that a JavaScript function can be located in a &lt;script&gt; or in a file. There are 3 basic ways to call a JavaScript function.</p>
<ul>
<li>From another function or JavaScript code;</li>
<li>When an event occurs. For example user click a button or a link;</li>
<li>Automatic invocation (self invoked).</li>
</ul>

<h2><a id="parameters"/>Function Parameters</h2>
<p>A function can have no parameters, one or several parameters.
The parameters can can have initial values defined with "=" after parameter name.
In next example p2 has default value 10. Parameters with default value are optional.
Parameters with no default value are mandatory. In next case, p1 is mandatory</p>
<div>
<pre><code class="language-javascript line-numbers">/* parameter p2 is optional */
function myFunction(p1, p2 = 10) {
   return p1 * p2;
}
/* test function invocation */
let x = myFunction(5, 5);
let y = myFunction(5);
console.log(x); //expected 25
console.log(y); //expected 50</code></pre>
</div>

<h2><a id="result"/>Function Result</h2>
<p>A function can calculate a value and return value back to the caller. We use "return" keyword. In the previous example we have used an expression to return the result of multiplication between the two arguments. Results can be ignored in JavaScript. That means you can use a function like you normally use a procedure in a procedural language.In this case, maybe the function has side-effects that we want.
</p>

<div class="alert alert-danger"><span style="color:red">Alert: </span>If a function do not explicit return a result in JavaScript, actually returns <em>undefined</em> value and can't be used in expressions. If you do then the expression will produce <em>NaN</em> or <em>undefined</em> value.</div>


<h2>Multiple results</h2>
<p>JavaScript functions can create multiple results using JSON notation. This is anonymous block enclosed in curly brackets and separated by comma. Actually in this case the result is an anonymous object that contains several values as attributes.We can unpack these values using assignment and destructuring.
</p>
<h4>Example:</h4>
<p>Capture results using anonymous object:</p>
<div>
<pre><code class="language-javascript line-numbers">// return two results as object
function two(a, b) {
   return {a, b};
};
// capture 2 results
let result = two(4,7);
// display attributes
console.log(result.a); // 4
console.log(result.b); // 7</code></pre>
</div>

<h4>Example:</h4>
<p>Capture result using destructuring:</p>
<div>
<pre><code class="language-javascript line-numbers">function f() {
   return [1, 2];
}
let [a, b] = f();
console.log(a); // 1
console.log(b); // 2</code></pre>
</div>

<h2><a id="output">Output Parameters</h2>
<p>Normally a function is using the parameter for input, but sometimes it is useful to use the parameters for output. That means instead of using the return statement to return a result, you assign the result to the parameter. Output parameters can be used to propagate multiple results back to the caller.</p>

<h4>Example:</h4>
<div>
<pre><code class="language-javascript line-numbers">//prepare output variable
let output
function get_back(callback) {
   //execute callback function
   callback({value:"yes"});
}
//call a function with call-back parameter
get_back((result) =&gt; {
   output = result;
})
//verify output value
console.log(output.value);</code></pre></div>

<p><b>Notes:</b>&nbsp;
In previous example I have used many things you may not be yet familiar with. The output parameter has name: result and is parameter of an anonymous arrow function. The arrow function is declared with "=&gt;" that looks like an arrow. This function is transmitted to get_back() as callback function having the name: <em>callback</em> for this case,but could have any other name.</p>

<div class="alert alert-warning"><b>Caution:</b>&nbsp;Any output parameter must be an object, otherwise the parameter value will not propagate back. Other arguments are pass by value not by reference, therefore can not be used as output parameters.</div>

<h2>Functional Programming</h2>
<p>JavaScript can be used as a functional programming language. This is very good feature of JavaScript. It may be difficult to understand at the beginning. Pay attention and memorize the fundamental concepts of functional programming, then use the examples to understand more:</p>

<p><b>Concepts:</b></p>
<ul>
<li>A function is a reference to an object;</li>
<li>You can assign a function to a variable;</li>
<li>You can create a function that can have as a result another function;</li>
<li>You can use a function as a parameter to call other function;</li>
<li>You can execute a function by using a variable instead of function name;</li>
</ul>
<p>Functions that manipulate other functions are called: "high order functions".</p>

<h4>Example:</h4>
<p>In this example we use a higher order function to create a closure. The closure is a function that can create another function. The created function is enclosed in a closure and it has special properties that makes its behavior unique.</p>
<div>
<pre><code class="language-javascript line-numbers">// define high order function
function counter() {
   var count = 0;
   return {
      getCount: function getCount() {return count;},
      increment: function increment() {count += 1;
   };
  };
};

// capture two closures
let closure = counter();

// use first closure
closure.increment(); //increment once
closure.increment(); //increment twice

// use second closure
console.log(closure.getCount()); //2</code></pre>
</div>

<p><b>Note:</b>&nbsp;This example demonstrate how to create two functions: increment() and getCount() that are encapsulated into an anonymous object created by a single return statement. Read the concepts below to understand better what is happening here:</p>
<ul>
<li>A high order function is a function that return other function;</li>
<li>A closure is a high order function that create another function;</li>
<li>The closure create a local context for enclosed functions;</li>
</ul>
<h2>Callback functions</h2>
<p>A "callback function" is a parameter of a high order function. It is called "call back" since it can be invoked from the higher order function. Callback functions can be anonymous functions or arrow functions that look like an expression. If you do not pay attention to this you may read others people code and do not even realize that a function need a callback parameter.</p>

<h4>Example:</h4>
<div>
<pre><code class="language-javascript line-numbers">// higher order function:
function bar(foo, a, b) {
   return foo(a,b);
};
// normal function
function sum(x, y) {
   return x+y;
}
// use normal function for callback
test = bar(sum, 4, 3)
console.log(test); // 7
// use function expression to create callback
test = bar( function(x,y) {return x+y},2,2)
console.log(test); // 4
// use arrow function to create callback
test = bar( (x,y) =&gt; {return x+y},4,4)
console.log(test); // 8</code></pre>
</div>
<p><b>Note:&nbsp;</b>Example above is using new concepts to create callback functions:"expression function" and "arrow function". These two kind of functions can be named or unnamed. In our case the name of the callback function will be "foo" because is the name of the formal parameter of the high order function that is "bar". </p>

<h2><a id="expression"/>Expression Functions</h2>

<p>An expression function is a function that is created at runtime using an expression. Expression functions can be assigned to variables and executed later. The declaration of expression functions is very unusual. Read the example to understand how "foo" is in fact a function.</p>

<h4>Example:</h4>
<div>
<pre><code class="language-javascript line-numbers">// create expression function foo
const foo = function(x,y) {return x + y};
// test expression function
console.log( foo(1,3) ); // 4
console.log( foo(4,4) ); // 8</code></pre>
</div>
<h2><a id="arrow">Arrow functions</h2>
<p>An arrow function is using symbol "=&gt;" to associate a list of parameters with an expression. In this case the keyword "function" is missing, but the expression is actually assigned to a variable that becomes function. The variable name can be executed later as a function with parameters and it can return a result.</p>

<h4>Example:</h4>

<pre><code class="language-javascript line-numbers">// create arrow functions
const f = (x,y) =&gt; { return x + y };
const g = (x) =&gt; { return x };
const h = () =&gt; { return 1 };
// single parameter do not require ()
const p = x =&gt; { return x };
// test arrow functions
console.log( f(4,4) ); // 8
console.log( g(4) ); // 4
console.log( h(4) ); // 1
console.log( p(7) ); // 7
// you can even do this:
test = ((a, b) =&gt; {return a + b})(4,2);
console.log(test); // 6
</code></pre>

<p><b>Note:</b>&nbsp;We have used the new keyword: "const" to declare expressions. This will help to avoid overriding by mistake an expression function that was already defined. You can also use "let" to create a handler for the expression functions.A common mistake is to use "var". This enable you to recreate a function in a loop, over and over again. This works, but the performances could be miserable. It is a very bad mistake easy to avoid if you use "const".</p>
<p><b>Homework:</b></p>
<p>Try the next example and observe that it does not produce the right result. Then fix the code and run it again.The solution of the problem is explained in the comments. So read the solution and try to understand the code.This example was created to demonstrate how to use output parameters.
</p>
<ul>
<li>Open and run demo 1:&nbsp;
<a href="https://repl.it/@elucian/callwithmistake" target="_blank" rel="nofollow noopener noreferrer">incorrect function call</a></li>
<li>Open and run demo 2:&nbsp;
<a href="https://repl.it/@elucian/callwithout" target="_blank" rel="nofollow noopener noreferrer">correct function call</a></li>
</ul>

<p> I hope you have enjoy learning about JavaScript functions. Now you should know to create and use functions in your scripts.Next we will larn about control flow and structured programming.Take a break and continue later. Thanks for reading!
</p>
<hr>

<h2><a id="execution"/>Function Execution</h2>

<p>Java function can be executed in syncrhon or asynchronous mode. First mode is the default mode and is used in single thread applications. Asynchronous mode is used to create multi-thread applications in JavaScript.</p>

<h3>Synchronous Calls</h3>

<div class="alert alert-secondary shadow-sm">Up until now we have learned synchronous JavaScript. That is when you call a function the caller must wait until the function returns. When the function takes a long time to respond we have a blockage that slow down the program.To improve performance you can use Asynchronous calls.</div>

<h3>Asynchronous Call</h3>

<div class="alert alert-secondary shadow-sm">Assynchronous call is a way fo calling a functions in a secondary thread, to improve performance.This enable main program to continue main thread in parallel,and do not wait for the result. When the function terminate, will send a message back to main thread to announce that it has finished the job.Until then the result is pending and can not be used.
</div>

<hr>

<p>There are two main types of asynchronous code style you'll come across in JavaScript code, old-style callbacks and newer promise-style code.In the below sections we'll review each of these in turn.</p>

<h4>Async Callbacks</h4>

<p>Async <em>callbacks</em> are functions that are specified as arguments when calling another functionwhich will execute code in the background. When the background code finishes running, it calls the callback function to let you know the work is done.</p>

<p><b>Demo:&nbsp;</b>We have preloaded source file: "async-demo.js" containing a callback function. This load a resource via the XMLHttpRequest API that is called from a wrapper. You can open the console (F12), select "source" tab, and investigate the source file (call_back.js).Let's preview the code before we execute this demo:
</p>

<pre><code class="language-javascript line-numbers">/* async-demo.js content */
function loadAsset(url, type, callback) {
  let xhr = new XMLHttpRequest();

  // fetch the image from URL
  xhr.open('GET', url);
  xhr.responseType = type;

  // hook up the callback function
  xhr.onload = function() {
    callback(xhr.response);
  };

  xhr.send();
}

// function wrapper that interact with DOM
function displayImage(blob) {
  let objectURL = URL.createObjectURL(blob);

  let image = document.createElement('img');
  image.src = objectURL;

  // find the target div that is display below
  const target = document.querySelector('#load-async-demo');
  target.appendChild(image);
}
</code></pre>

<p>We can call this function: displayImage() using a JavaScript link that looks like this:</p>

<pre>
<code class="language-html">&lt;a href="javascript:loadAsset('img/tezaur.jpg', 'blob', displayImage)"&gt;discover&lt;/a&gt;</code>
</pre>

<p><b>Note:&nbsp;</b>Method xhr.open() belongs to object xhr of type XMLHttpRequest.We have not created this function ourselves but we have used it. Next we will learn how to create new asynchronous functions.
</p>

<hr>
<p>Let's find the ancient tresure using this link: <a href="javascript:loadAsset('img/tezaur.jpg', 'blob', displayImage)">discover</a></p>

<!-- placehoder for a picture that pop-up when click: execute -->
<div id="load-async-demo" align="center"><hr></div>


<h2><a id = "promises"/>Promises</h2>

<div class="alert alert-secondary shadow-sm">A Promise is an object that represents the eventual completion (or failure) of an asynchronous operation and its resulting value. It allows you to associate handlers with success value or failure reasonan for an asynchronous action.
</div>

<p>This is the secret. A promise lets asynchronous methods to return values like synchronous methods: instead of immediately returning the final value, the asynchronous method returns a promise.It will eventually supply the result value at some point in the future.</p>

<h3>Promise states:</h3>

<p>A promise can have one of 3 states:</p>
<ul>
<li><b>pending</b>: initial state, neither fulfilled nor rejected.</li>
<li><b>fulfilled</b>: meaning that the operation was completed successfully.</li>
<li><b>rejected</b>: meaning that the operation failed.</li>
</ul>

<h3>Promise fulfillment</h3>

<div class="alert alert-info">A promise is said to be <em>settled</em> if is either fulfilled or rejected, but not pending. You will also hear the synonim term: <em>resolved</em> used with promises. This means that the promise is locked-in to match the state of another promise.</div>

<p>A <em>pending</em> promise can either be fulfilled with a value or rejected with an error. When either of these options happens, the associated handlers queued then() are called one by one. Sometimes the promise has already been fulfilled or rejected when a corresponding handler is attached.In this case, the handler will be called immediately</p>

<h3>Promise methods:</h3>

<p>A Promise has methods used to associate callback action with a promise that becomes settled. </p>

<ul>
<li><b>promise.then()</b> is triggered when promise is succesful;</li>
<li><b>promise.catch()</b> is triggered when promise is rejected;</li>
<li><b>promise.finally()</b> is triggered when promise is settled;</li>
</ul>

<p><b>Method Resut:&nbsp;</b> Promise methods return a newly generated promise object, which can optionally be used for chaining multiple promises. We will explain chain promises using a pseudocode.Let's investigate this workflow diagram:
</p>

<div align="center">
  <img src="img/promises.jpg" alt="decision" srcset="img/promises.svg" width="640" class="img-fluid protect rounded shadow border" >
  <p>Promise Fulfillment</p>
</div>

<hr>

<h3>Chained Promises:</h3>

<p>In next pseudo-code example we chain one promise with 3 other downstream promises and one final catch handler.</p>

<pre><code class="language-javascript line-numbers">/* chained promises */
const myPromise =
  (new Promise(myExecutorFunc))
  .then(handleFulfilledA)
  .then(handleFulfilledB)
  .then(handleFulfilledC)
  .catch(handleRejectedAny);
</code></pre>

<p><b>Example:</b>

<p>In this example, we use setTimeout() to simulate a process. In reality, you will probably be using something like XHR or an HTML5 API,that may take a long time to execute. You can copy/paste this example in console to verify.
</p>

<pre><code class="language-javascript line-numbers">// create an empty promise
let myFirstPromise = new Promise((resolve, reject) => {
  setTimeout( function() {
    resolve("timer stop!")  // Yay! Everything went well!
  }, 5000)
})

//control message
console.log("timer start: wait for it ...")

//wait for promise to execute
myFirstPromise.then((successMessage) => {
  console.log("Done! " + successMessage)
});</code></pre>


<p>Learn more about promises here:
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"
   rel ="nofollow noopener noreferrer">MDN Promises</a>

<hr>

<h2><a  id="asynch"/>Asynchronous Functions</h2>

<p>So far we have learned how to create a Promise, that is an Object. It is a bit inconvenient to use. We have a pair of keywords in JavaScript that enable creation of Asynchronous functions or expressions.These can be used to create parallel threads.
</p>

<p><b>Syntax:</b>

<pre><code class="language-javascript line-numbers">async function name([param[, param[, ...param]]]) {
   //statements
   [await n]
}
</code></pre>

<h4>Notes:</h4>
<ul>
<li><em>name:</em> The function’s name.
<li><em>param:</em> The name of an argument to be passed to the function;
<li><em>statements:</em> The statements comprising the body of the function;
<li>The <em>await</em> keyword can be used in <em>async</em> function;
</ul>

<p><b>Example:</b>

<pre><code class="language-javascript line-numbers">/* this function return a promise */
function resolveAfterNSeconds(n) {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve('resolved in:'+n+'s');
    }, 1000*n);
  });
}

/* asynchronous function resolve a promise */
async function asyncCall(x) {
  console.log('calling');
  const result = await resolveAfterNSeconds(x);
  console.log(result); // expected output: "resolved"
}

/* various calls that execute in parallel */
asyncCall(25); //25 seconds
asyncCall(10); //10 seconds
asyncCall(5);  //5  seconds
asyncCall(30); //30 seconds
</code></pre>

<p><b>Homework: </b>If you copy/paste previous program in console, you will see first messages when each timer expire. First of course is: resolve:5 andtotal time of execution is 30 seconds.That proves asynchronous functions are executed in parallel.You can invoke the function manually while the promises are pending  (console is not blocked).
</p>

<p><b>Output:</b></p>

<pre><code class="language-output">resolved in:5s
resolved in:10s
resolved in:25s
resolved in:30s
</code></pre>

<p><b>Read next: </b>
<a href="control.html">Control Flow</a></p>

<!-- Footer -->
<footer class="footer">
  <div class="footer-copyright text-center"></div>
</footer>

<!-- Load demo JS -->
<script src="js/async-demo.js"></script>

</div>
</body>
</html>